<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>完善企业信息</title>
    <link href="Content/bootstrap.css" rel="stylesheet" />
    <link href="Content/style.css" rel="stylesheet" />
    <link href="Content/sweet-alert.css" rel="stylesheet" />
    <link href="Scripts/bootstrap-datepicker-master/dist/css/bootstrap-datepicker3.css" rel="stylesheet" />
    <script src="Scripts/jquery-3.1.0.js"></script>
    <script src="Scripts/bootstrap.js"></script>
    <script src="Scripts/sweet-alert.js"></script>
    <script src="Scripts/bootstrap-datepicker-master/dist/js/bootstrap-datepicker.js"></script>
    <script src="Scripts/bootstrap-datepicker-master/dist/locales/bootstrap-datepicker.zh-CN.min.js"></script>
    <script src="Scripts/jquery.maskedinput.js"></script>
</head>
<body>
    <div class="nav navbar-inverse navbar-fixed-top" th:include="header.html::nav-top">
    </div>
    <div class="container body-content">
        <h2>添加详细信息</h2>
        <div class="row">
            <ul id="myTabs" class="nav nav-tabs" role="tablist">
                <li role="presentation" class="active"><a href="#home" id="home-tab" role="tab" data-toggle="tab" aria-controls="home" aria-expanded="true">完善企业及个人信息</a></li>
                <li role="presentation" class=""><a href="#profile" role="tab" id="profile-tab" data-toggle="tab" aria-controls="profile" aria-expanded="false">上传营业执照</a></li>
                
            </ul>
            <div id="myTabContent" class="tab-content">
                <div role="tabpanel" class="tab-pane fade active in" id="home" aria-labelledby="home-tab">
                    <br/>
                    <form id="form1" name="form1" class="form-horizontal" action="./details" method="post">
                        <input type="hidden" id="hide_companyId" name="hide_companyId" th:value="${corporate.id}"/>
                        <fieldset>
                            <legend>企业信息</legend>
                            <div class="form-group">
                                <label class="col-md-2 control-label">编号：</label>
                                <div class="col-md-2">
                                    <input type="text" class="form-control input-sm" id="code" name="code" th:value="${corporate.code}" readonly="readonly" />
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="col-md-2 control-label">企业名称：</label>
                                <div class="col-md-5">
                                    <input type="text" class="form-control input-sm" id="company_name" name="company_name" th:value="${corporate.name != null}? ${corporate.name} : ''" />
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="col-md-2 control-label">所属行业：</label>
                                <div class="col-md-10">
                                    <div class="row">
                                        <div class="col-md-2">
                                            <select id="industry_level1" name="industry_level1" class="form-control input-sm">
                                                <option th:each="industry:${industries}"
                                                        th:value="${industry.id}"
                                                        th:text="${industry.name}"
                                                        th:selected="${industry.id == #strings.arraySplit(corporate.industry,',')[0]}">0</option>
                                            </select>
                                        </div>
                                        <div class="col-md-2">
                                            <select id="industry_level2" name="industry_level2" class="form-control input-sm">
                                                <option th:each="option:${level2_industries}" 
                                                        th:value="${option.id}"
                                                        th:text="${option.name}"
                                                        th:selected="${option.id == #strings.arraySplit(corporate.industry,',')[1]}">0</option>
                                            </select>
                                        </div>
                                        <div class="col-md-2">
                                            <select id="industry_level3" name="industry_level3" class="form-control input-sm">
                                                <option th:each="option:${level3_industries}" 
                                                        th:value="${option.id}"
                                                        th:text="${option.name}"
                                                        th:selected="${option.id == #strings.arraySplit(corporate.industry,',')[2]}">0</option>
                                            </select>
                                        </div>
                                        <div class="col-md-2">
                                            <select id="industry_level4" name="industry_level4" class="form-control input-sm">
                                                <option th:each="option:${level4_industries}" 
                                                        th:value="${option.id}"
                                                        th:text="${option.name}"
                                                        th:selected="${option.id == #strings.arraySplit(corporate.industry,',')[3]}">0</option>
                                            </select>
                                        </div>
                                    </div>
                                    <!--<input type="text" class="form-control input-sm" id="company_industry" name="company_industry"  th:value="${corporate.industry != null}? ${corporate.industry} : ''"/>-->
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="col-md-2 control-label">所在地区：</label>
                                <div class="col-md-10">
                                    <div class="row">
                                        <div class="col-md-2">
                                            <select class="form-control input-sm" id="company_province" name="company_province">
                                                <option th:value="${province.code}" 
                                                        th:text="${province.name}" 
                                                        th:each="province:${provinces}"
                                                        th:selected="${province.code == corporate.province}">选择省份</option>
                                            </select>
                                        </div>
                                        <div class="col-md-2">
                                            <select class="form-control input-sm" id="company_city" name="company_city">
                                                <option th:each="city:${cities}"
                                                        th:value="${city.code}"
                                                        th:text="${city.name}"
                                                        th:selected="${city.code == corporate.city}">选择市</option>
                                            </select>
                                        </div>
                                        <div class="col-md-2">
                                            <select class="form-control input-sm" id="company_area" name="company_area">
                                                <option th:each="area:${areas}"
                                                        th:value="${area.code}"
                                                        th:text="${area.name}"
                                                        th:selected="${area.code == corporate.area}">选择区</option>
                                            </select>
                                        </div>
                                        <div class="col-md-6">
                                            <input type="text" class="form-control input-sm" id="company_address" placeholder="详细地址信息" name="company_address" th:value="${corporate.address != null}? ${corporate.address} : ''" />
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="col-md-2 control-label">客户等级：</label>
                                <div class="col-md-2">
                                    <select class="form-control input-sm" id="company_level" 
                                            name="company_level">
                                        <option th:each="level:${levels}"
                                                th:value="${level.level}"
                                                th:text="${level.name}"
                                                th:selected="${level.level == corporate.level}">1级</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="col-md-2 control-label">联系方式：</label>
                                <div class="col-md-10">
                                    <div class="row">
                                        <div class="form-inline col-md-3">
                                            电话：<input type="text" class="form-control input-sm" id="company_phone" name="company_telephone"  style="width:180px" th:value="${corporate.name != phone}? ${corporate.phone} : ''"/>
                                        </div>
                                        <div class="form-inline col-md-3">
                                            传真：<input type="text" class="form-control input-sm" id="company_fax" name="company_fax"  style="width:170px" th:value="${corporate.fax != null}? ${corporate.fax} : ''"/>
                                        </div>
                                        <div class="form-inline col-md-3">
                                            400电话：<input type="text" class="form-control input-sm" id="company_400Phone" name="company_400Phone"  style="width:160px" th:value="${corporate._400Phone != null}? ${corporate._400Phone} : ''"/>
                                        </div>
                                    </div>
                                    
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="col-md-2 control-label">企业邮箱：</label>
                                <div class="col-md-5">
                                    <input type="text" id="company_email" name="company_email" class="form-control input-sm"  th:value="${corporate.email != null}? ${corporate.email} : ''"/>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="col-md-2 control-label">法人信息：</label>
                                <div class="col-md-10">
                                    <div class="row">
                                        <div class="form-inline col-md-3">
                                            姓名：<input type="text" id="legalman_name" name="legalman_name" class="form-control input-sm" style="width:180px"  th:value="${corporate.legal_name != null}? ${corporate.legal_name} : ''"/>
                                        </div>
                                        <div class="form-inline col-md-3">
                                            手机号：<input type="text" id="legalman_mobile" name="legalman_mobile" class="form-control input-sm" style="width:170px"  th:value="${corporate.legal_mobile != null}? ${corporate.legal_mobile} : ''"/>
                                        </div>
                                        <div class="form-inline col-md-3">
                                            座机号：<input type="text" id="legalman_phone" name="legalman_phone" class="form-control input-sm"  style="width:170px" th:value="${corporate.legal_phone != null}? ${corporate.legal_phone} : ''"/>
                                        </div>
                                        <div class="form-inline col-md-3">
                                            QQ：<input type="text" id="legalman_qq" name="legalman_qq" class="form-control input-sm" style="width:170px" th:value="${corporate.legal_qq != null}? ${corporate.legal_qq} : ''" />
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="col-md-2 control-label">公司主页：</label>
                                <div class="col-md-10">
                                    <input type="text" id="company_homepage" name="company_homepage" class="form-control input-sm" th:value="${corporate.official_website != null}? ${corporate.official_website} : 'http://'" />
                                </div>
                            </div>
                        </fieldset>
                        <fieldset>
                            <legend>联系人信息</legend>
                            <input type="hidden" id="hide_linkmanAction" value="edit" />
                            <input type="hidden" id="hide_linkmanId" th:value="${user.id}" />
                            <div class="form-group">
                                <label class="col-md-2 control-label">名称或称呼：</label>
                                <div class="col-md-5">
                                    <input type="text" id="linkman_name" name="linkman_name" class="form-control input-sm" th:value="${user.name}" />
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="col-md-2 control-label">手机号码：</label>
                                <div class="col-md-4">
                                    <input type="text" id="linkman_mobile" name="linkman_mobile" class="form-control input-sm" th:value="${user.mobile}" />
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="col-md-2 control-label">电话：</label>
                                <div class="col-md-10">
                                    <div class="row">
                                        <div class="form-inline">
                                            <div class="col-md-2">
                                                <input type="text" id="linkman_phone_part1" name="linkman_phone_part1" class="form-control input-sm" th:value="${user.telephone != null}? ${#strings.arraySplit(user.telephone,'-')[0]} : ''" />
                                            </div>
                                            -<input type="text" id="linkman_phone_part2" name="linkman_phone_part2" class="form-control input-sm" style="margin-left: 10px;width:200px" th:value="${user.telephone != null}? ${#strings.arraySplit(user.telephone,'-')[1]} : ''"/>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="col-md-2 control-label">个人邮箱：</label>
                                <div class="col-md-6">
                                    <input type="text" id="linkman_email" name="linkman_email" class="form-control input-sm" th:value="${user.email != null}?${user.email} : ''" />
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="col-md-2 control-label">QQ：</label>
                                <div class="col-md-4">
                                    <input type="text" id="linkman_qq" name="linkman_qq" class="form-control input-sm" th:value="${user.qq != null}? ${user.qq} : ''" />
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="col-md-2 control-label">需求或说明：</label>
                                <div class="col-md-10">
                                    <textarea id="linkman_note" name="linkman_note" class="form-control input-sm" rows="6" th:value="${user.summary != null}? ${user.summary} : ''"></textarea>
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="col-md-offset-2 col-md-10">
                                    <button type="button" id="btnSaveLinkman" class="btn btn-sm" data-action="edit">保存联系人</button>
                                    <button type="button" id="btnNewLinkman" class="btn btn-sm">新建联系人</button>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="col-md-2 control-label">联系人列表：</label>
                                <div class="col-md-10">
                                    <table class="table table-bordered table-condensed">
                                        <thead>
                                            <tr>
                                                <th style="width:40px">编号</th>
                                                <th>名称</th>
                                                <th>手机号</th>
                                                <th>个人邮箱</th>
                                                <th>QQ</th>
                                                <th style="width:100px">操作</th>
                                            </tr>
                                        </thead>
                                        <tbody id="tbody1">
                                            <tr th:each="user:${users}">
                                                <td th:text="${user.id}">1</td>
                                                <td th:text="${user.name}">1</td>
                                                <td th:text="${user.mobile}"></td>
                                                <td th:text="${user.email}">1</td>
                                                <td th:text="${user.qq}">1</td>
                                                <td>
                                                    <a href="javascript:;" th:onclick="'editUser(\'' + ${user.id} + '\');'">修改</a>
                                                    |
                                                    <a href="javascript:;" th:onclick="'deleteUser(\'' +${user.id} + '\')'">删除</a>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            <hr/>
                            <div class="form-group">
                                <label class="col-md-2 control-label">账户信息：</label>
                                <div class="col-md-10">
                                    <div class="row">
                                        <div class="form-inline col-md-3">
                                            账户：<input id="account_name" name="account_name" type="text" class="form-control" th:value="${account.account_name != null}? ${account.account_name} : ''" />
                                        </div>
                                        <div class="form-inline col-md-3">
                                            密码：<input id="account_password" name="account_password" type="text" class="form-control" th:value="${account.account_password != null}? ${account.account_password} : ''" />
                                        </div>
                                        <div class="form-inline col-md-3" id="start_div">
                                            起始：<input id="account_starttime" name="account_starttime" type="text" class="form-control" th:value="${account.account_startdate != null}? ${account.account_startdate} : ''" />
                                        </div>
                                        <div class="form-inline col-md-3">
                                            结束：<input id="account_endtime" name="account_endtime" type="text" class="form-control" th:value="${account.account_enddate != null}? ${account.account_enddate} : ''" />
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <hr/>
                            <div class="form-group">
                                <div class="col-md-offset-2 col-md-10 text-center">
                                    <button type="submit" id="btnSubmit" class="btn btn-primary">提交企业资料</button>
                                    <div id="div_output" class="alert alert-success" role="alert" style="display:none">企业信息提交成功</div>
                                </div>
                            </div>
                        </fieldset>
                    </form>  
                    
                </div>
                <div role="tabpanel" class="tab-pane fade" id="profile" aria-labelledby="profile-tab">
                    <form id="form2" class="form-horizontal" th:action="@{./upload(id = ${corporate.id})}" enctype="multipart/form-data" method="post">
                        <br/>
                        <div class="form-group">
                            <label class="col-md-2 control-label">选择图片：</label>
                            <div class="col-md-10">
                                <div class="row">
                                    <div class="col-md-6">
                                        <input type="file" multiple class="filestyle" id="fileInput" name="fileInput" />
                                    </div>
                                    <div class="col-md-2">
                                        <button type="submit" class="btn btn-default">上传图片</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-md-2 control-label">图片预览：</label>
                            <div class="col-md-6">
                                <div class="thumbnail">
                                    <img id="img1" style="min-height:300px;width: 100%; display: block;" th:src="'.' + ${corporate.image_url}">                                    
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <script src="Scripts/jsrender.js"></script>
    <script src="Scripts/jquery.form.js"></script>
    <script src="Scripts/bootstrap-filestyle.js"></script>
    <script type="text/x-jsrender" id="template1">
        {{for items}}
        <tr>
            <td>{{:id}}</td>
            <td>{{:name}}</td>
            <td>{{:mobile}}</td>
            <td>{{:email}}</td>
            <td>{{:qq}}</td>
            <td>
                <a href="javascript:;" onclick="editUser({{:id}});">修改</a>
                |
                <a href="javascript:;" onclick="deleteUser({{:id}})">删除</a>
            </td>
        </tr>
        {{/for}}
    </script>
    <script type="text/javascript">
        $(function () {
            $("#industry_level1").change(function () {
                var val = $(this).val();
                if (val != "0") {
                    $.get("./restful/service/industry/get/" + val, function (result) {
                        if (result != null) {
                            $("#industry_level2").empty();
                            $("#industry_level2").append($("<option/>", { value: "-1", text: "选择行业" }));
                            $.each(result, function (index, item) {
                                $("#industry_level2").append($("<option/>", { value: item.id, text: item.name }));
                            });
                            $("#industry_level3").empty();
                            $("#industry_level3").append($("<option/>", { value: "-1", text: "选择行业" }));
                            $("#industry_level4").empty();
                            $("#industry_level4").append($("<option/>", { value: "-1", text: "选择行业" }));
                        }
                    })
                } else {
                    $("#industry_level2").empty();
                    $("#industry_level2").append($("<option/>", { value: "-1", text: "选择行业" }));
                    $("#industry_level3").empty();
                    $("#industry_level3").append($("<option/>", { value: "-1", text: "选择行业" }));
                    $("#industry_level4").empty();
                    $("#industry_level4").append($("<option/>", { value: "-1", text: "选择行业" }));
                }
            });
            $("#industry_level2").change(function () {
                var val = $(this).val();
                if (val != "0") {
                    $.get("./restful/service/industry/get/" + val, function (result) {
                        if (result != null) {
                            $("#industry_level3").empty();
                            $("#industry_level3").append($("<option/>", { value: "-1", text: "选择行业" }));
                            $.each(result, function (index, item) {
                                $("#industry_level3").append($("<option/>", { value: item.id, text: item.name }));
                            })
                            $("#industry_level4").empty();
                            $("#industry_level4").append($("<option/>", { value: "-1", text: "选择行业" }));
                        }
                    })
                } else {
                    $("#industry_level3").empty();
                    $("#industry_level3").append($("<option/>", { value: "-1", text: "选择行业" }));
                    $("#industry_level4").empty();
                    $("#industry_level4").append($("<option/>", { value: "-1", text: "选择行业" }));
                }
            });
            $("#industry_level3").change(function () {
                var val = $(this).val();
                if (val != "0") {
                    $.get("./restful/service/industry/get/" + val, function (result) {
                        if (result != null) {
                            $("#industry_level4").empty();
                            $("#industry_level4").append($("<option/>", { value: "-1", text: "选择行业" }));
                            $.each(result, function (index, item) {
                                $("#industry_level4").append($("<option/>", { value: item.id, text: item.name }));
                            })
                        }
                    })
                }
            });
            $("#company_province").change(function () {
                var val = $(this).val();
                if (val != "0") {
                    $.get("./restful/service/city/get/" + val, function (result) {
                        if (result != null) {
                            $("#company_city").empty();
                            $("#company_city").append($("<option/>", { value: "0", text: "选择市" }));
                            $("#company_area").empty();
                            $("#company_area").append($("<option/>", { value: "0", text: "选择区" }));
                            $.each(result, function (index, item) {
                                $("#company_city").append($("<option/>", { value: item.code, text: item.name }));
                            })
                        }
                    })
                } else {
                    $("#company_city").empty();
                    $("#company_city").append($("<option/>", { value: "0", text: "选择市" }));
                    $("#company_area").empty();
                    $("#company_area").append($("<option/>", { value: "0", text: "选择区" }));
                }
            });
            $("#company_city").change(function () {
                var val = $(this).val();
                if (val != "0") {
                    $.get("./restful/service/area/get/" + val, function (result) {
                        if (result != null) {
                            $("#company_area").empty();
                            $("#company_area").append($("<option/>", { value: "0", text: "选择区" }));
                            $.each(result, function (index, item) {
                                $("#company_area").append($("<option/>", { value: item.code, text: item.name }));
                            })
                        }
                    })
                } else {
                    $("#company_area").empty();
                    $("#company_area").append($("<option/>", { value: "0", text: "选择区" }));
                }
            });
            $("#linkman_mobile").blur(function () {
                var linkman_action = $("#btnSaveLinkman").data("action");
                if (linkman_action === "new") {
                    var mobile = $(this).val();
                    if (!(/^1[3|4|5|7|8]\d{9}$/.test(mobile))) {
                        alert("手机号码有误，请重新输入");
                        $("#linkman_mobile").val("");
                        $("#linkman_mobile").focus();
                        return false;
                    } else {
                        $.ajax({
                            type: "post",
                            url: "/try/restful/service/check/mobile",
                            contentType: "application/json;charset=utf-8",
                            dataType: "json",
                            data: mobile,
                            success: function (result) {
                                if (result > 0) {
                                    alert("此手机号已经存在，请重新输入");
                                    $("#linkman_mobile").val("");
                                    $("#linkman_mobile").focus();
                                }
                            }
                        })
                    }
                } else {
                    var mobile = $(this).val();
                    if (!(/^1[3|4|5|7|8]\d{9}$/.test(mobile))) {
                        alert("手机号码有误，请重新输入");
                        $("#linkman_mobile").val("");
                        $("#linkman_mobile").focus();
                        return false;
                    }
                }

            });
            $("#btnSaveLinkman").click(function () {
                var action = $(this).data("action");
                if ($("#linkman_name").val() == "") {
                    alert("请输入名称或称呼");
                    $("#linkman_name").focus();
                    return false;
                }
                if ($("#linkman_mobile").val() == "") {
                    alert("请输入联系人手机号");
                    $("#linkman_mobile").focus();
                    return false;
                }
                if ($("#linkman_phone_part1").val() == "") {
                    alert("请输入联系人电话的区号");
                    $("#linkman_phone_part1").focus();
                    return false;
                }
                if ($("#linkman_phone_part2").val() == "") {
                    alert("请输入联系人7-8位电话号码");
                    $("#linkman_phone_part2").focus();
                    return false;
                }
                //if ($("#linkman_email").val() == "") {
                //    alert("请输入联系人邮箱");
                //    $("#linkman_email").focus();
                //    return false;
                //}
                //if ($("#linkman_qq").val() == "") {
                //    alert("请输入联系人QQ号");
                //    $("#linkman_qq").focus();
                //    return false;
                //}
                if (action === "edit") {
                    var linkmanId = $("#hide_linkmanId").val();
                    var data = {
                        id: linkmanId,
                        name: $("#linkman_name").val(),
                        mobile: $("#linkman_mobile").val(),
                        telephone: $("#linkman_phone_part1").val() + "-" + $("#linkman_phone_part2").val(),
                        summary: $("#linkman_note").val(),
                        is_new: 0,
                        corporate_id: $("#hide_companyId").val(),
                        email: $("#linkman_email").val(),
                        qq: $("#linkman_qq").val()
                    };
                    $.ajax({
                        type: "post",
                        url: "./restful/service/userinfo/update",
                        contentType: "application/json;charset=utf-8",
                        dataType: "json",
                        data: JSON.stringify(data),
                        success: function (result) {
                            if (result > 0) {
                                loadUser($("#hide_companyId").val());
                                clearLinkmanInputs();
                                $("btnSaveLinkman").data("action","new");
                            }
                        }
                    })
                }
                if (action === "new") {
                    var data = {
                        name: $("#linkman_name").val(),
                        mobile: $("#linkman_mobile").val(),
                        telephone: $("#linkman_phone_part1").val() + "-" + $("#linkman_phone_part2").val(),
                        summary: $("#linkman_note").val(),
                        is_new: 0,
                        corporate_id: $("#hide_companyId").val(),
                        email: $("#linkman_email").val(),
                        qq: $("#linkman_qq").val()
                    };
                    $.ajax({
                        type: "post",
                        url: "./restful/service/userinfo/new",
                        contentType: "application/json;charset=utf-8",
                        dataType: "json",
                        data: JSON.stringify(data),
                        success: function (result) {
                            if (result > 0) {
                                loadUser($("#hide_companyId").val());
                                clearLinkmanInputs();
                            }
                        }
                    })
                }

            });
            $("#btnNewLinkman").click(function () {
                clearLinkmanInputs();
            })
            $('#account_starttime').datepicker({
                clearBtn: true,
                language: "zh-CN",
                autoclose: true,
                todayHighlight: true
            });
            $('#account_endtime').datepicker({
                clearBtn: true,
                language: "zh-CN",
                autoclose: true,
                todayHighlight: true
            });
            var options = {
                target:"",
                beforeSubmit: function () {
                    if ($("#company_name").val() == "") {
                        alert("企业名称不能为空");
                        $("#company_name").focus();
                        return false;
                    }
                    if ($("#industry_level1").val() == "-1") {
                        alert("请选择所属行业");
                        $("#industry_level1").focus();
                        return false;
                    }
                    if ($("#company_province").val() == "0") {
                        alert("请选择所在省");
                        $("#company_province").focus();
                        return false;
                    }
                    if ($("#company_city").val() == "") {
                        alert("请选择所在市");
                        $("#company_city").focus();
                        return false;
                    }
                    if ($("#company_phone").val() == "") {
                        alert("请输入企业联系电话");
                        $("#company_phone").focus();
                        return false;
                    }
                    if ($("#account_name").val() != "" && $("#account_password").val() != "") {
                        if ($("#account_starttime").val() == "") {
                            alert("请选择开始日期");
                            $("#account_starttime").focus();
                            return false;
                        }
                        if ($("#account_endtime").val() == "") {
                            alert("请选择结束日期");
                            $("#account_endtime").focus();
                            return false;
                        }
                    }

                },
                success:function(responseText,responseStatus){
                    if(responseText == 1){
                        $("#div_output").fadeIn("slow", function () {
                            $("#div_output").fadeOut("slow", function () {
                                window.location.href = "./trylist";
                            });
                        })
                    }
                }
            }
            $("#form1").submit(function(){
                $(this).ajaxSubmit(options);
                return false;
            });
            $("#company_email").blur(function () {
                var email = $(this).val();
                if (!email.match(/^\w+((-\w+)|(\.\w+))*\@[A-Za-z0-9]+((\.|-)[A-Za-z0-9]+)*\.[A-Za-z0-9]+$/)) {
                    alert("邮箱格式不正确");
                    $("#company_email").val("");
                    $("#company_email").focus();
                    return false;
                }
            });
            $("#legalman_mobile").blur(function () {
                var isMobile = /^(((13[0-9]{1})|(15[0-9]{1})|(18[0-9]{1})|(17[0-9]{1})|(14[0-9]{1}))+\d{8})$/;
                var mobile = $(this).val();
                if (!isMobile.test(mobile)) {
                    alert("手机号码格式不正确");
                    $("#legalman_mobile").val("");
                    $("#legalman_mobile").focus();
                    return false;
                }
            });
            $("#linkman_mobile").blur(function () {
                var isMobile = /^(((13[0-9]{1})|(15[0-9]{1})|(18[0-9]{1})|(17[0-9]{1})|(14[0-9]{1}))+\d{8})$/;
                var mobile = $(this).val();
                if (!isMobile.test(mobile)) {
                    alert("手机号码格式不正确");
                    $("#linkman_mobile").val("");
                    $("#linkman_mobile").focus();
                    return false;
                }
            });
            $("#company_phone").blur(function () {
                var isPhone = /^(?:(?:0\d{2,3})-)?(?:\d{7,8})(-(?:\d{3,}))?$/;
                var phone = $(this).val();
                if (!isPhone.test(phone)) {
                    alert("电话号码格式不正确,电话号码正确的格式为：区号-电话号");
                    $("#company_phone").val("");
                    $("#company_phone").focus();
                    return false;
                }
            });
            $("#company_fax").blur(function () {
                var phone = $(this).val();
                if (phone != "") {
                    var isPhone = /^(?:(?:0\d{2,3})-)?(?:\d{7,8})(-(?:\d{3,}))?$/;
                    if (!isPhone.test(phone)) {
                        alert("传真号码格式不正确");
                        $("#company_fax").val("");
                        $("#company_fax").focus();
                        return false;
                    }
                }
            });
            $("#legalman_phone").blur(function () {
                var phone = $(this).val();
                if (phone != "") {
                    var isPhone = /^(?:(?:0\d{2,3})-)?(?:\d{7,8})(-(?:\d{3,}))?$/;
                    if (!isPhone.test(phone)) {
                        alert("座机号码格式不正确");
                        $("#legalman_phone").val("");
                        $("#legalman_phone").focus();
                        return false;
                    }
                }
            });
            $("#legalman_qq").blur(function () {
                var qq = $(this).val();
                if (qq != "") {
                    var reQQ = /^[1-9]\d{4,9}$/;
                    if (!reQQ.test(qq)) {
                        alert("QQ码格式不正确");
                        $("#legalman_qq").val("");
                        $("#legalman_qq").focus();
                        return false;
                    }
                }
            });
            $("#company_homepage").blur(function () {
                var homepage = $(this).val();
                if (homepage != "") {
                    var re = /^((http|https):\/\/)?(\w(\:\w)?@)?([0-9a-z_-]+\.)*?([a-z0-9-]+\.[a-z]{2,6}(\.[a-z]{2})?(\:[0-9]{2,6})?)((\/[^?#<>\/\\*":]*)+(\?[^#]*)?(#.*)?)?$/i;
                    if (!re.test(homepage)) {
                        alert("公司主页格式不正确");
                        $("#company_homepage").val("");
                        $("#company_homepage").focus();
                        return false;
                    }
                }
            });
            $("#fileInput").filestyle({
                buttonText: "选择图片",
                buttonName: "btn-primary",
                size: "sm"
            });
            var uploadOptions = {
                target: "",
                beforeSubmit: function () {

                },
                success: function (responseText, responseStatus) {
                    if (responseText != "") {
                        var obj = $.parseJSON(responseText);
                        if (obj.status == 1) {
                            $("#img1").prop("src", "." + obj.path);
                        }
                    }
                }
            };
            $("#form2").submit(function () {
                $(this).ajaxSubmit(uploadOptions);
                return false;
            })
        });


        function clearLinkmanInputs() {
            $("#linkman_name").val("");
            $("#linkman_mobile").val("");
            $("#linkman_phone_part1").val("");
            $("#linkman_phone_part2").val("");
            $("#linkman_email").val("");
            $("#linkman_qq").val("");
            $("#linkman_note").val("");
            $("#btnSaveLinkman").data("action", "new");
        }
        function loadUser(corporate_id) {
            $.get("./restful/service/userinfo/bycorporate/" + corporate_id, function (result) {
                if (result != null) {
                    $("#tbody1").empty();
                    var data = { items: result };
                    var html = $("#template1").render(data);
                    $("#tbody1").html(html);
                }
            })
        }
        function editUser(id){
            $.get("./restful/service/userinfo/findById/" + id, function (result) {
                if (result != null) {
                    $("#hide_linkmanId").val(id);
                    $("#linkman_name").val(result.name);
                    $("#linkman_mobile").val(result.mobile);
                    $("#linkman_phone_part1").val(result.telephone.split('-')[0]);
                    $("#linkman_phone_part2").val(result.telephone.split('-')[1]);
                    $("#linkman_email").val(result.email);
                    $("#linkman_qq").val(result.qq);
                    $("#btnSaveLinkman").data("action", "edit");
                    $("#linkman_note").val(result.summary);

                }
            })
        };
        function deleteUser(id){
            swal({
                title: "确认信息",
                text: "确定要删除此联系人吗？",
                showCancelButton: true,
                cancelButtonText: "取消",
                confirmButtonColor: "DD6B55",
                confirmButtonText:"确定"
            }, function () {
                $.get("./restful/service/userinfo/deleteById/" + id, function (result) {
                    if (result > 0) {
                        loadUser($("#hide_companyId").val());
                    }
                })
            })
        }
    </script>
    <script src="Scripts/bootstrap-filestyle.js"></script>
</body>
</html>